name = "peptalk-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
account_id = "ec358c7d7cf76532fe1a4160b10a8247"
workers_dev = true

# Workers configuration (no build needed - uses TypeScript directly)

# D1 Database bindings
[[d1_databases]]
binding = "DB"
database_name = "peptalk-db"
database_id = "df17e106-fbd7-430f-be81-b03661ee430a"

# R2 Storage bindings
[[r2_buckets]]
binding = "PDF_BUCKET"
bucket_name = "peptalk-pdfs"

# KV Namespace for rate limiting
[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "3d1a9c2146c04e28bee9c2d8f4565b1c"

# Environment variables
[vars]
ENVIRONMENT = "production"

# Secrets (set via wrangler secret put)
# - JWT_SECRET
# - RESEND_API_KEY
# - STRIPE_API_KEY
# - STRIPE_WEBHOOK_SECRET
# - PUBMED_EMAIL
# - PUBMED_API_KEY
# - ANTHROPIC_API_KEY
# - OPENAI_API_KEY
# - CRON_SECRET
# - INTERNAL_API_SECRET
# - R2_PUBLIC_URL

# Cron triggers
[triggers]
crons = ["0 0 * * SUN"]  # Every Sunday at midnight UTC

# Queue bindings
[[queues.producers]]
queue = "research-pipeline"
binding = "RESEARCH_QUEUE"

[[queues.consumers]]
queue = "research-pipeline"
max_batch_size = 1
max_batch_timeout = 30

# Development configuration
[env.development]
name = "peptalk-api-dev"

[[env.development.d1_databases]]
binding = "DB"
database_name = "peptalk-db-dev"
database_id = "YOUR_DEV_D1_DATABASE_ID"

[[env.development.r2_buckets]]
binding = "PDF_BUCKET"
bucket_name = "peptalk-pdfs-dev"

[[env.development.kv_namespaces]]
binding = "RATE_LIMIT"
id = "YOUR_DEV_KV_NAMESPACE_ID"
